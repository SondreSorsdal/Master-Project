---
title: "Statistic Task"
author: "Sondre Kaastad Soersdal"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

## Loading Packages

```{r message=FALSE, warning=FALSE}
#Loading packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, car,knitr,sjPlot,sjmisc,DescTools,
               gridExtra,knitr,kableExtra,PMCMR,FSA,readxl,
               sjlabelled,scales,reshape2,broom,dunn.test)
#Setting options - alter to your working directory
opts_knit$set(root.dir = "C:/Users/Sondre/Documents/Master/Master-Project/plum")
options(knitr.kable.NA = '')
```


## 1.1: Frass spray application

## 1: Comparing the Aphid Shoots Plum by treatment

```{r message=FALSE, warning=FALSE}
# Aphid_shoots_plum data
Aphid_shoots_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Aphid_shoots_plum")
#Including tretement 1,2,4,5,6,7
#Filtering  Replica #5 for treatment 1 and 2
#Filtering Replica #3 and treatment 6
Aphid_shoots_plum  <- Aphid_shoots_plum  %>%
  filter(treatment != 3) %>%
  filter(treatment <= 7) %>%
  filter(replica !=5 | treatment > 2) %>%
  filter(replica != 3 | treatment != 6)
```

### Descriptive statistics of Aphid Shoots by Treatment

```{r message=FALSE, warning=FALSE}
aphid_shoots_mean <- data.frame(Aphid_shoots_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(aphid_shoots),
                                            SD = sd(aphid_shoots),
                                            Minimum = min(aphid_shoots),
                                            Maximum =max(aphid_shoots)))
#Table average of Aphid Shots by treatment
tab_df(aphid_shoots_mean,
       title = "Table 1: Descriptive Statistics of Aphid Shoots Plum by Treatment")
```

### Checking Normality of Aphid Shoots Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Aphid Shoots Plum is normal.
$H_1$: The distribution of Aphid Shoots Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Aphid_shoots_plum$aphid_shoots)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.80,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Aphid Shoots Plum is normal", is rejected. Hence, the Aphid Shoots Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Aphid Shoots by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Aphid_shoots_plum$treatment <- as.factor(Aphid_shoots_plum$treatment)
##Boxplots
Hist_Aphid_Shoots_plum <- ggplot(Aphid_shoots_plum,aes(x=aphid_shoots))+
  geom_histogram(fill="darkblue",col="red",binwidth = 1)+xlab("Aphid Shoots Plum")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_Aphid_Shoots_plum
#Save plot
ggsave("Hist_Aphid_Shoots_plum_1.1.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Aphid Shoots Plum are different than each other, as some of them are highly skewed, and some of these are slightly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.


### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Aphid Shoots Plum by treatments.
$H_1$: There is a difference in average Aphid Shoots Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest1 <- kruskal.test(aphid_shoots~treatment,Aphid_shoots_plum)
#Reporting results
noquote("Results of Kruskal-Wallis H Test")
cat("Kruskal-Wallis chi-squared =",243,"\n")
cat("Degree of Freedom =",5,"\n")
cat("P-value <","0.0001","\n")
```
It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Aphid Shoots Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Aphid Shoots Plum by Treatments. 

### Dunn's Test for checking significant difference of Aphid Shoots by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(aphid_shoots~treatment,Aphid_shoots_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(aphid_shoots~treatment,Aphid_shoots_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],4))
# Creating Table
tab_df(Post_Hoc,title = "Table 2: Post-Hoc Aphid Shoots Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. For example, the p-value of pair `4-1` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `4` have higher value of Aphid Shoots Plum as compared to treatment.


### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_aphid_shoots_plum <- ggplot(Aphid_shoots_plum,aes(treatment,aphid_shoots))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("APhid Shots Plum Average");error_bars_aphid_shoots_plum
#Save plot
ggsave("error_bars_aphid_shoots_plum_1.1.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```

From the visual comparison, it can be observed that the tretment `5` has the higher value Aphid Shoots Plum as compared to all other treatments. Similarly, all the other differences can be asses by observing the visualization. 

## 2: Comparing the Aphid population Plum by treatment

```{r message=FALSE, warning=FALSE}
# Aphid_population_plum data
Aphid_population_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Aphid_population_plum")
#Including tretement 1,2,4,5,6,7
#Filtering  Replica #5 for treatment 1 and 2
#Filtering Replica #3 and treatment 6
Aphid_population_plum  <- Aphid_population_plum  %>%
  filter(treatment != 3) %>%
  filter(treatment <= 7) %>%
  filter(replica !=5 | treatment > 2) %>%
  filter(replica != 3 | treatment != 6)
```


### Descriptive statistics of Aphid Population Plum by Treatment

```{r message=FALSE, warning=FALSE}
aphid_population_mean <- data.frame(Aphid_population_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(aphid_population),
                                            SD = sd(aphid_population),
                                            Minimum = min(aphid_population),
                                            Maximum =max(aphid_population)))
#Table average of Aphid Shots by treatment
tab_df(aphid_population_mean,
       title = "Table 3: Descriptive Statistics of Aphid Population Plum by Treatment")
```


### Checking Normality of Aphid Population Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Aphid Population Plum is normal.
$H_1$: The distribution of Aphid Population Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Aphid_population_plum$aphid_population)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.60,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Aphid Population Plum is normal", is rejected. Hence, the Aphid Population Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Aphid Population by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Aphid_population_plum$treatment <- as.factor(Aphid_population_plum$treatment)
##Boxplots
Hist_Aphid_population_plum <- ggplot(Aphid_population_plum,aes(x=aphid_population))+
  geom_histogram(fill="darkblue",col="red",binwidth = 20)+xlab("Aphid Population Plum")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_Aphid_population_plum
#Save plot
ggsave("Hist_Aphid_population_plum_1.1.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Aphid Shoots Plum are different than each other, as some of them are highly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.

### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Aphid Population Plum by treatments.
$H_1$: There is a difference in average Aphid Population Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest2 <- kruskal.test(aphid_population~treatment,Aphid_population_plum)
#Reporting results
noquote("Results of Kruskal-Wallis rank sum test")
cat("Kruskal-Wallis chi-squared =",279,"\n")
cat("Degree of Freedom =",5,"\n")
cat("P-value <","0.0001","\n")
```

It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Aphid Population Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Aphid Population Plum by Treatments. 


### Dunn's Test for checking significant difference of Aphid Population by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(aphid_population~treatment,Aphid_population_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(aphid_population~treatment,Aphid_population_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],3))
# Creating Table
tab_df(Post_Hoc,title = "Table 4: Post-Hoc Aphid Population Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. For example, the p-value of pair `4-1` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `4` have higher value of Aphid Population Plum as compared to treatment.

### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_Aphid_Population_plum <- ggplot(Aphid_population_plum,aes(treatment,aphid_population))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("Aphid Population Plum Average");error_bars_Aphid_Population_plum
#Save plot
ggsave("error_bars_Aphid_Population_plum.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```

From the visual comparison, it can be observed that the treatment `6` has the higher value Aphid Shoots Plum as compared to all other treatments. Similarly, all the other differences can be asses by observing the visualization. 

## 3: Comparing the Aphid Mites Plum for each treatment

```{r message=FALSE, warning=FALSE}
# Mites_plum data
Mites_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Mites_plum")
#Including tretement 1,2,4,5,6,7
#Filtering  Replica #5 for treatment 1 and 2
#Filtering Replica #3 and treatment 6
Mites_plum  <- Mites_plum %>%
  filter(treatment != 3) %>%
  filter(treatment <= 7) %>%
  filter(replica !=5 | treatment > 2) %>%
  filter(replica != 3 | treatment != 6)
```

### Descriptive statistics of Mites Total by Treatment

```{r message=FALSE, warning=FALSE}
Mites_plum_mean <- data.frame(Mites_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(total_mites),
                                            SD = sd(total_mites),
                                            Minimum = min(total_mites),
                                            Maximum =max(total_mites)))
tab_df(Mites_plum_mean,
       title = "Table 5: Descriptive Statistics of Mites Total Plum by Treatment")
```

### Checking Normality of Aphid Population Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Total Mites Plum is normal.
$H_1$: The distribution of Total Mites Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Mites_plum$total_mites)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.60,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Total Mites Plum is normal", is rejected. Hence, the Aphid Total Mites Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Total Mites by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Mites_plum$treatment <- as.factor(Mites_plum$treatment)
##Boxplots
Hist_total_mites_plum <- ggplot(Mites_plum,aes(x=total_mites))+
  geom_histogram(fill="darkblue",col="red",binwidth = 8)+xlab("")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_total_mites_plum
#Save plot
ggsave("Hist_total_mites_plum_1.1.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Total Mites Plum are different than each other, as some of them are highly skewed, and some of these are slightly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.

### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Total Mites Plum by treatments.
$H_1$: There is a difference in average Total Mites Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest3 <- kruskal.test(total_mites~treatment,Mites_plum)
#Reporting results
noquote("Results of Kruskal-Wallis rank sum test")
cat("Kruskal-Wallis chi-squared =",17,"\n")
cat("Degree of Freedom =",5,"\n")
cat("P-value <","0.005","\n")
```

It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Total Mites Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Total Mites Plum by Treatments. 


### Dunn's Test for checking significant difference of Total Mites Plum by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(total_mites~treatment,Mites_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(total_mites~treatment,Mites_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],3))
# Creating Table
tab_df(Post_Hoc,title = "Table 6: Post-Hoc Total Mites Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. The p-value of only pair `6-2` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `6` have higher value of Mites Plum as compared to other treatment.

### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_total_mites_plum <- ggplot(Mites_plum,aes(treatment,total_mites))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("Total Mites Plum Average");error_bars_total_mites_plum
#Save plot
ggsave("error_bars_total_mites_plum_1.1.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```


From the visual comparison, it can be observed that the treatment `5` has the higher value Total Mites Plum as compared to all other treatments. Similarly, all the other differences can be assess by observing the visualization. 



## 1.2: Frass in soil


## 1: Comparing the Aphid Shoots Plum by treatment

```{r message=FALSE, warning=FALSE}
# Aphid_shoots_plum data
Aphid_shoots_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Aphid_shoots_plum")
#Only taking treatment 1,3,8, and 9
Aphid_shoots_plum  <- Aphid_shoots_plum  %>%
  filter(treatment == 1|treatment == 3|treatment == 8|treatment == 9) 
```

### Descriptive statistics of Aphid Shoots by Treatment

```{r message=FALSE, warning=FALSE}
aphid_shoots_mean <- data.frame(Aphid_shoots_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(aphid_shoots),
                                            SD = sd(aphid_shoots),
                                            Minimum = min(aphid_shoots),
                                            Maximum =max(aphid_shoots)))
#Table average of Aphid Shots by treatment
tab_df(aphid_shoots_mean,
       title = "Table 1: Descriptive Statistics of Aphid Shoots Plum by Treatment")
```

### Checking Normality of Aphid Shoots Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Aphid Shoots Plum is normal.
$H_1$: The distribution of Aphid Shoots Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Aphid_shoots_plum$aphid_shoots)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.80,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Aphid Shoots Plum is normal", is rejected. Hence, the Aphid Shoots Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Aphid Shoots by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Aphid_shoots_plum$treatment <- as.factor(Aphid_shoots_plum$treatment)
##Boxplots
Hist_Aphid_Shoots_plum <- ggplot(Aphid_shoots_plum,aes(x=aphid_shoots))+
  geom_histogram(fill="darkblue",col="red",binwidth = 1)+xlab("Aphid Shoots Plum")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_Aphid_Shoots_plum
#Save plot
ggsave("Hist_Aphid_Shoots_plum_1.2.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Aphid Shoots Plum are different than each other, as some of them are highly skewed, and some of these are slightly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.


### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Aphid Shoots Plum by treatments.
$H_1$: There is a difference in average Aphid Shoots Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest1 <- kruskal.test(aphid_shoots~treatment,Aphid_shoots_plum)
#Reporting results
noquote("Results of Kruskal-Wallis H Test")
cat("Kruskal-Wallis chi-squared =",221,"\n")
cat("Degree of Freedom =",3,"\n")
cat("P-value <","0.0001","\n")
```
It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Aphid Shoots Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Aphid Shoots Plum by Treatments. 

### Dunn's Test for checking significant difference of Aphid Shoots by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(aphid_shoots~treatment,Aphid_shoots_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(aphid_shoots~treatment,Aphid_shoots_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],4))
# Creating Table
tab_df(Post_Hoc,title = "Table 2: Post-Hoc Aphid Shoots Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. For example, the p-value of pair `8-1` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `8` have higher value of Aphid Shoots Plum as compared to treatment `1`.


### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_aphid_shoots_plum <- ggplot(Aphid_shoots_plum,aes(treatment,aphid_shoots))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("APhid Shots Plum Average");error_bars_aphid_shoots_plum
#Save plot
ggsave("error_bars_aphid_shoots_plum_1.2.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```

From the visual comparison, it can be observed that the treatment `9` has the higher value Aphid Shoots Plum as compared to all other treatments. Similarly, all the other differences can be asses by observing the visualization. 

## 2: Comparing the Aphid population Plum by treatment

```{r message=FALSE, warning=FALSE}
# Aphid_population_plum data
Aphid_population_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Aphid_population_plum")
#Only taking treatment 1,3,8, and 9
Aphid_population_plum <- Aphid_population_plum  %>%
  filter(treatment == 1|treatment == 3|treatment == 8|treatment == 9) 
```


### Descriptive statistics of Aphid Population Plum by Treatment

```{r message=FALSE, warning=FALSE}
aphid_population_mean <- data.frame(Aphid_population_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(aphid_population),
                                            SD = sd(aphid_population),
                                            Minimum = min(aphid_population),
                                            Maximum =max(aphid_population)))
#Table average of Aphid Shots by treatment
tab_df(aphid_population_mean,
       title = "Table 3: Descriptive Statistics of Aphid Population Plum by Treatment")
```


### Checking Normality of Aphid Population Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Aphid Population Plum is normal.
$H_1$: The distribution of Aphid Population Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Aphid_population_plum$aphid_population)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.60,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Aphid Population Plum is normal", is rejected. Hence, the Aphid Population Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Aphid Population by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Aphid_population_plum$treatment <- as.factor(Aphid_population_plum$treatment)
##Boxplots
Hist_Aphid_population_plum <- ggplot(Aphid_population_plum,aes(x=aphid_population))+
  geom_histogram(fill="darkblue",col="red",binwidth = 20)+xlab("Aphid Population Plum")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_Aphid_population_plum
#Save plot
ggsave("Hist_Aphid_population_plum_1.2.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Aphid Shoots Plum are different than each other, as some of them are highly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.

### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Aphid Population Plum by treatments.
$H_1$: There is a difference in average Aphid Population Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest2 <- kruskal.test(aphid_population~treatment,Aphid_population_plum)
#Reporting results
noquote("Results of Kruskal-Wallis rank sum test")
cat("Kruskal-Wallis chi-squared =",269,"\n")
cat("Degree of Freedom =",3,"\n")
cat("P-value <","0.0001","\n")
```

It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Aphid Population Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Aphid Population Plum by Treatments. 


### Dunn's Test for checking significant difference of Aphid Population by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(aphid_population~treatment,Aphid_population_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(aphid_population~treatment,Aphid_population_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],3))
# Creating Table
tab_df(Post_Hoc,title = "Table 4: Post-Hoc Aphid Population Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. For example, the p-value of pair `8-1` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `8` have higher value of Aphid Population Plum as compared to treatment `1`.

### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_Aphid_Population_plum <- ggplot(Aphid_population_plum,aes(treatment,aphid_population))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("Aphid Population Plum Average");error_bars_Aphid_Population_plum
#Save plot
ggsave("error_bars_Aphid_Population_plum_1.2.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```

From the visual comparison, it can be observed that the treatment `9` has the higher value Aphid Shoots Plum as compared to all other treatments. Similarly, all the other differences can be asses by observing the visualization. 

## 3: Comparing the Aphid Mites Plum for each treatment

```{r message=FALSE, warning=FALSE}
# Mites_plum data
Mites_plum <- read_excel("Plumtrees_insects.xlsx",
                                sheet="Mites_plum")
#Only taking treatment 1,3,8, and 9
Mites_plum <- Mites_plum  %>%
  filter(treatment == 1|treatment == 3|treatment == 8|treatment == 9) 
```

### Descriptive statistics of Mites Total by Treatment

```{r message=FALSE, warning=FALSE}
Mites_plum_mean <- data.frame(Mites_plum %>%
                                  group_by(treatment) %>%
                                  summarise(Mean = mean(total_mites),
                                            SD = sd(total_mites),
                                            Minimum = min(total_mites),
                                            Maximum =max(total_mites)))
tab_df(Mites_plum_mean,
       title = "Table 5: Descriptive Statistics of Mites Total Plum by Treatment")
```

### Checking Normality of Aphid Population Plum 

For normality, we are conducting a Shapiro-Wilk normality test. The null and alternative hypotheses for this test are given below:

$H_0$: The distribution of Total Mites Plum is normal.
$H_1$: The distribution of Total Mites Plum is not normal.

```{r message=FALSE,warning=FALSE}
normal_test <- shapiro.test(Mites_plum$total_mites)
noquote("Shapiro-Wilk normality test")
cat("Test Statistic (W) =", 0.70,"\n")
cat("P-value <", 0.0001,"\n")
```

The P-value of Shapiro-Wilk test is found to be lower than `0.0001`, which suggests that the null hypothesis of the "The distribution of Total Mites Plum is normal", is rejected. Hence, the Aphid Total Mites Plum is not normal, and the Parametric test is not appropriate here.

Since, we need to compare the Total Mites by Treatments, and the treatment groups are more than two. Hence, a non-parametric test (Kruskal-Wallis Test) alternative to One-Way ANOVA, is appropriate to achieve the study purposes. 

### Plotting Histogram for checking Shape

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=15,fig.align='center'}
#Converting treatment to factors
Mites_plum$treatment <- as.factor(Mites_plum$treatment)
##Boxplots
Hist_total_mites_plum <- ggplot(Mites_plum,aes(x=total_mites))+
  geom_histogram(fill="darkblue",col="red",binwidth = 8)+xlab("")+ylab("")+
  facet_wrap(treatment~.,scales = "free",ncol=7)+
  theme_bw()+ylab("Counts");Hist_total_mites_plum
#Save plot
ggsave("Hist_total_mites_plum_1.2.tiff", units="in", width=15, height=5, dpi=300, compression = 'lzw')
```

Histograms suggesting that the shapes of distributions of the Total Mites Plum are different than each other, as some of them are highly skewed, and some of these are slightly skewed, and they have different variability among each other. Hence, the mean comparison through Kruskal Wallis test is appropriate here.

### Implementing Kruskal Wallis Test

The null and alternative hypotheses for this test are given below:

$H_0$: There is no difference in average Total Mites Plum by treatments.
$H_1$: There is a difference in average Total Mites Plum by treatments.

```{r message=FALSE, warning=FALSE}
#Kruskal Wallis test
kstest3 <- kruskal.test(total_mites~treatment,Mites_plum)
#Reporting results
noquote("Results of Kruskal-Wallis rank sum test")
cat("Kruskal-Wallis chi-squared =",13,"\n")
cat("Degree of Freedom =",3,"\n")
cat("P-value =","0.004","\n")
```

It can be observed that the p-value of Kruskal-Wallis test is lower than `0.05` (level of significance). Hence, the null hypothesis will be rejected, and it is concluded that there is a significant difference in the average Total Mites Plum by treatments.

For comparing the average significant difference in each pair of treatments, we conducted Dunn's Test, which is post-hoc test, and used when the null hypothesis if Kruskal-Wallis test is rejected. Also, for visual comparison, we have plotted the average and error-bars for Total Mites Plum by Treatments. 


### Dunn's Test for checking significant difference of Total Mites Plum by Treatment

```{r message=FALSE, warning=FALSE}
#Computing all pairwise average differences
Mean_Diff <-TukeyHSD(aov(total_mites~treatment,Mites_plum))$treatment %>%
  data.frame() %>%rownames_to_column(.,var="Pairs") %>% 
  mutate(Difference=round(diff,3)) %>%
  select(1,6)

#Calculating p-values for sinficance of average differences, using bonferroni method
options(digits = 3,scipen = 999)
dun_test <- dunnTest(total_mites~treatment,Mites_plum,method="bonferroni")
#Creating table of results
Post_Hoc <- cbind(Mean_Diff,P_Values = round(dun_test$res[4],3))
# Creating Table
tab_df(Post_Hoc,title = "Table 6: Post-Hoc Total Mites Plum by Treatment",digits = 3)
```

The average difference in each pair is presented in above table, and Adjusted P-values (p-adj), are also presented in the last column. The Adjusted P-values are calculated using `Bonferroni` method, as we are conducting the multiple test.

However, the difference having adjusted p-value lower than `0.05`, are considered as significant difference. The p-value of only pair `8-1` is found to be less than `0.05`, hence this difference is significant and positive. It suggests that the Treatment `8` have higher value of Mites Plum as compared to other treatment `1`.

### Plotting for visual comparisons 

```{r message=FALSE,warning=FALSE,fig.height=4,fig.width=6,fig.align='center'}
##Boxplots
error_bars_total_mites_plum <- ggplot(Mites_plum,aes(treatment,total_mites))+
  geom_bar(fill="darkblue",stat = "summary",fun="mean",col="red")+xlab("Treatment")+
  geom_errorbar(stat='summary', width=0.8,position = "dodge",col="red")+
  theme_bw()+ylab("Total Mites Plum Average");error_bars_total_mites_plum
#Save plot
ggsave("error_bars_total_mites_plum_1.2.tiff", units="in", width=10, height=5, dpi=300, compression = 'lzw')
```


From the visual comparison, it can be observed that the treatment `9` has the higher value Total Mites Plum as compared to all other treatments. Similarly, all the other differences can be assess by observing the visualization. 




